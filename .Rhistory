ggplot(data,aes(PC1,PC2, colour = OGT)) +
geom_point(color = as.character(data$OGT_color), size = 3) +
theme(axis.title.x = element_text(hjust = 0.5),axis.title.y = element_text(hjust = 0.5)) +
theme_classic(base_line_size = 1, base_size = 16) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1))
dev.off()
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
theme(axis.title.x = element_text(hjust = 0.5),axis.title.y = element_text(hjust = 0.5)) +
guides(fill = guide_legend(title = "Clades")) +
theme_classic(base_line_size = 1, base_size = 16) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom",legend.text = element_text(size = 10))
tiff("./Plots/PCA by Cluster.tiff",width = 8,height = 5.5, units = "in", res = 1200)
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
theme(axis.title.x = element_text(hjust = 0.5),axis.title.y = element_text(hjust = 0.5)) +
guides(fill = guide_legend(title = "Clades")) +
theme_classic(base_line_size = 1, base_size = 16) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom",legend.text = element_text(size = 10))
dev.off()
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
theme(axis.title.x = element_text(hjust = 0.5),axis.title.y = element_text(hjust = 0.5)) +
guides(fill = guide_legend(title = "Clades")) +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom")
tiff("./Plots/PCA by Cluster.tiff",width = 8,height = 5.5, units = "in", res = 1200)
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
theme(axis.title.x = element_text(hjust = 0.5),axis.title.y = element_text(hjust = 0.5)) +
guides(fill = guide_legend(title = "Clades")) +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom")
dev.off()
tiff("./Plots/PCA by OGT.tiff",width = 8,height = 5.5, units = "in", res = 1200)
ggplot(data,aes(PC1,PC2, colour = OGT)) +
geom_point(color = as.character(data$OGT_color), size = 3) +
theme(axis.title.x = element_text(hjust = 0.5),axis.title.y = element_text(hjust = 0.5)) +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1))
dev.off()
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
theme(axis.title.x = element_text(hjust = 0.5),axis.title.y = element_text(hjust = 0.5)) +
guides(fill = guide_legend(title = "Clades")) +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom")
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
#theme(axis.title.x = element_text(hjust = 0.5),axis.title.y = element_text(hjust = 0.5)) +
guides(fill = guide_legend(title = "Clades")) +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom")
ggplot(data,aes(PC1,PC2, colour = OGT)) +
geom_point(color = as.character(data$OGT_color), size = 3) +
ggtitle("PCA of Aliphatic Index by Protein Family Colored by OGT ") +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1))
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
guides(fill = guide_legend(title = "Clades")) +
ggtitle("PCA of Aliphatic Index by Protein Family Colored by Sub-Clades") +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom")
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
guides(fill = guide_legend(title = "Clades")) +
ggtitle("(A)  PCA of Aliphatic Index by Protein Family Colored by Sub-Clades") +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom")
tiff("./Plots/PCA by Cluster.tiff",width = 8,height = 5.5, units = "in", res = 1200)
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
guides(fill = guide_legend(title = "Clades")) +
ggtitle("(A)  PCA of Aliphatic Index by Protein Family Colored by Sub-Clades") +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom")
dev.off()
tiff("./Plots/PCA by OGT.tiff",width = 8,height = 5.5, units = "in", res = 1200)
ggplot(data,aes(PC1,PC2, colour = OGT)) +
geom_point(color = as.character(data$OGT_color), size = 3) +
ggtitle("(B)  PCA of Aliphatic Index by Protein Family Colored by OGT") +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1))
dev.off()
tiff("./Plots/PCA by Cluster.tiff",width = 8,height = 5.5, units = "in", res = 1200)
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
guides(fill = guide_legend(title = "Clades")) +
ggtitle("(A)  PCA of Aliphatic Index by Protein Family Colored by Sub-Clades") +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom", plot.title = element_text(hjust = 0.5))
dev.off()
tiff("./Plots/PCA by OGT.tiff",width = 8,height = 5.5, units = "in", res = 1200)
ggplot(data,aes(PC1,PC2, colour = OGT)) +
geom_point(color = as.character(data$OGT_color), size = 3) +
ggtitle("(B)  PCA of Aliphatic Index by Protein Family Colored by OGT") +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1), plot.title = element_text(hjust = 0.5))
dev.off()
# Seperate family tree into main genera and into sub-genera clusters based on OGT calculations
library(ape) # read.tree()
library(phytools) # midpoint.root()
library(treeio) # rename_taxa()
library(DECIPHER) # ReadDendrogram()
library(ggtree)
library(ggpubr) # stat_cor
#-----------------------------------------------------------------------load files------------------------------------------------------------------------
# load PATRIC phylogenetic files
treefile="./Data/Colwelliaceae Rooted Tree.nwk"
genomes = read.table("./Data/Colwelliaceae Rooted PATRIC Data.tsv",fill=T,head=T,sep="\t",colClasses="character")
# load growth rates, OGT, and OGT parameters of Colwelliaceae strains (Literature and novel)
GR = read.table("./Data/growthrates.tsv",fill=T,head=T,sep="\t",colClasses="character")
OGT = read.table("./Data/Strain Ratk OGT Final.tsv",fill=T,head=T,sep="\t",colClasses="character")
biospec = read.csv("./References/Literature Colwellia Growthrates.csv")
#nodes of interest to split the tree
main_nodes = c(169,145,142,116) # order of shallow to deep branched clade
temp_nodes = c(116,142,145,154,169,172,173,179)
#-----------------------------------------------------------------------set up files-----------------------------------------------------------------------
#read tree
tre.phylo = read.tree(treefile)
# remove any genomes that had poor assembly
tre.phylo = drop.tip(tre.phylo,"1380381.3")
# subset genomes that are only used in the phylogenetic tree
common_ids = intersect(tre.phylo$tip.label,genomes$genome.genome_id)
tre.phylo = keep.tip(tre.phylo, common_ids) # keeping the tips that are in the dataframe
#set up tree and rename tips with strain names
tre.phylo = midpoint.root(tre.phylo)
tre.phylo = ladderize(tre.phylo)
tre.phylo = rename_taxa(tre.phylo,genomes,genome.genome_id,genome.genome_name) # rename the ends.
# convert to dendrogram
dend = tre.phylo
dend$node.label = NULL
dend <- ReadDendrogram(textConnection(write.tree(dend)))
#set up column names and format to numeric
colnames(OGT)[1] = "strain"
OGT$OGT = as.numeric(OGT$OGT)
GR = GR[,c(1,3,4)]
GR$mumax = as.numeric(GR$mumax)
#----------------------------------------------------------------------set up tree splits and plot--------------------------------------------------------
#set up clusters for the main groups
tre.phylo.main = groupClade(tre.phylo,main_nodes)
tree.DF.main = as.data.frame(as_tibble(tre.phylo.main))
tree.DF.main = tree.DF.main[1:length(tre.phylo.main$tip.label),] # get just the groups associated with the tips
#set up clusters for the temperature phenotype groups
tre.phylo.temp = groupClade(tre.phylo,temp_nodes)
tree.DF.temp = as.data.frame(as_tibble(tre.phylo.temp))
tree.DF.temp = tree.DF.temp[1:length(tre.phylo.temp$tip.label),]
#--------------------------------------------------------------------set up ID files for each cluster type ------------------------------------------------
# set up the names of main clusters based on the group number
Main_ClusterID = data.frame(group = 0:4,ClusterName = c("Other Colwelliaceae","Clade A","Clade B","Other Colwelliaceae","Clade C"))
tree.DF.main = merge.data.frame(tree.DF.main,Main_ClusterID, by = "group", all = T)
tree.DF.main = tree.DF.main[,5:6]
# set up the names of temperature clusters based on the group number
Temp_ClusterID = data.frame(group = c(0:8),ClusterName = c("Other Colwelliaceae","Clade C","Other Colwelliaceae","Clade B2","Clade B1","Other Colwelliaceae","Clade A3","Clade A2","Clade A1"))
tree.DF.temp = merge.data.frame(tree.DF.temp,Temp_ClusterID, by = "group", all = T)
tree.DF.temp = tree.DF.temp[,5:6]
#set up color scheme
Temp.Clust.colors = data.frame(Clade = c("Clade A1","Clade A2","Clade A3","Clade B1","Clade B2","Clade C","Other Colwelliaceae"),
clustCol = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3",
"purple","black"))
col <- as.character(Temp.Clust.colors$clustCol)
names(col) = as.character(Temp.Clust.colors$Clade)
#phylo pairwise distances by genera
DistM.main = as.matrix(cophenetic.phylo(tre.phylo.main))
DistM.main = as.data.frame(DistM.main)
Main_Clade_Avg = data.frame()
for(i in 1:length(unique(tree.DF.main$ClusterName))) {
#get clade ID
clade_ID = sort(unique(tree.DF.main$ClusterName))[i]
print(as.character(clade_ID))
#get strain names within the clade
names = tree.DF.main[tree.DF.main$ClusterName == clade_ID,][["label"]]
#subset pairwise distance matrix by names and upper tri for calculations
data = DistM.main[names,names]
x = data*upper.tri(data)
x[x==0] = NA
#find average
avg = mean(as.vector(t(x)),na.rm = T)
#create dataframe
avg_df = data.frame(clade = paste(clade_ID),Dist_avg = avg,strain_num = length(names))
Main_Clade_Avg = rbind(Main_Clade_Avg,avg_df)
}
#print
Main_Clade_Avg
#phylo pairwise distances by genera sub-clades
DistM.temp = as.matrix(cophenetic.phylo(tre.phylo.temp))
DistM.temp = as.data.frame(DistM.temp)
Temp_Clade_Avg = data.frame()
for(i in 1:length(unique(tree.DF.temp$ClusterName))) {
#get clade ID
clade_ID = sort(unique(tree.DF.temp$ClusterName))[i]
print(as.character(clade_ID))
#get strain names within the clade
names = tree.DF.temp[tree.DF.temp$ClusterName == clade_ID,][["label"]]
#subset pairwise distance matrix by names and upper trie for calculations
data = DistM.temp[names,names]
x = data*upper.tri(data)
x[x==0] = NA
#find average
avg = mean(as.vector(t(x)),na.rm = T)
# create dataframe
avg_df = data.frame(clade = paste(clade_ID),Dist_avg = avg,strain_num = length(names))
Temp_Clade_Avg = rbind(Temp_Clade_Avg,avg_df)
}
#print
Temp_Clade_Avg
#--------------------------------Calculate average and standard devation of growth rate and OGT by Main Clade and Sub-Clade---------------------------
# merge growth rate data, OGT data, temperature, and main cluster ID
GR_OGT_Clade = merge.data.frame(GR,OGT,by = "strain", all = F)
GR_OGT_Clade$`Temp ClusterName` = tree.DF.temp$ClusterName[match(GR_OGT_Clade$strain,tree.DF.temp$label)]
GR_OGT_Clade$`Main ClusterName` = tree.DF.main$ClusterName[match(GR_OGT_Clade$strain,tree.DF.main$label)]
GR_OGT_Clade$Type = NULL
GR_OGT_Clade = GR_OGT_Clade[!is.na(GR_OGT_Clade$`Temp ClusterName`),]
# calculate by Temperature Clade the OGT
OGT_TC = GR_OGT_Clade %>% dplyr::group_by(`Temp ClusterName`) %>% dplyr::summarize(`Average OGT` = paste0(signif(mean(OGT),2)," ± ",signif(sd(OGT),2)),
`Min OGT` = signif(min(OGT)),`Max OGT` = signif(max(OGT)), N = length(unique(strain)))
# calculate by Main Clade the OGT
OGT_MC = GR_OGT_Clade %>% dplyr::group_by(`Main ClusterName`) %>% dplyr::summarize(`Average OGT` = paste0(signif(mean(OGT),2)," ± ",signif(sd(OGT),2)),
`Min OGT` = signif(min(OGT)),`Max OGT` = signif(max(OGT)), N = length(unique(strain)))
#calculate by Temperature Clade the growth rate
GR_TC = GR_OGT_Clade %>% dplyr::group_by(`Temp ClusterName`) %>% dplyr::summarize(`Average GR` = paste0(signif(mean(mumax),2)," ± ",signif(sd(mumax),2)),
`Min GR` = signif(min(mumax)),`Max GR` = signif(max(mumax)), N = length(unique(strain)))
#calculate by Main Clade the growth rate
GR_MC = GR_OGT_Clade %>% dplyr::group_by(`Main ClusterName`) %>% dplyr::summarize(`Average GR` = paste0(signif(mean(mumax),2)," ± ",signif(sd(mumax),2)),
`Min GR` = signif(min(mumax)),`Max GR` = signif(max(mumax)), N = length(unique(strain)))
# ANOVA of growthrate between temperature tested
GR_Temp_Tested_aov = aov(mumax~temp,data = GR_OGT_Clade)
summary(GR_Temp_Tested_aov)
#---------------------------------------------------------------- Plot Phylogenetic Tree -------------------------------------------------------------
# merge temp ID with OGT and clade colors and make the strains rownames
TC_df = merge(OGT, tree.DF.temp, by.x = "strain", by.y = "label", all.y= TRUE)
TC_df$`SubColor` = Temp.Clust.colors$clustCol[match(TC_df$ClusterName,Temp.Clust.colors$Clade)]
rownames(TC_df) = TC_df$strain
TC_df = as.matrix(TC_df)
#set the strain names in the order of the phylogenetic tree
TC_df = TC_df[tre.phylo$tip.label,]
TC_df = as.data.frame(TC_df)
TC_df$SubColor = as.character(TC_df$SubColor)
#set Sub-Clade colors as a factor list
SubClade_color = setNames(TC_df$SubColor,TC_df$ClusterName)
# add the colors to the dataframe and filter it by OGTs under 25 degrees C and set up facet names
GR_OGT_Clade$clustCol = Temp.Clust.colors$clustCol[match(GR_OGT_Clade$`Temp ClusterName`,Temp.Clust.colors$Clade)]
GR_OGT_Clade$temp = as.numeric(GR_OGT_Clade$temp)
Temp.labs = c("(A) Growth at -1°C","(B) Growth at 4°C","(C) Growth at 11°C","(D) Growth at 17°C")
names(Temp.labs) = c("-1","4","11","17")
ggplot(GR_OGT_Clade,aes(x = OGT,y = mumax)) +
geom_point(aes(color = `Temp ClusterName`)) +
stat_smooth(method = "lm", se = F,aes(group = 1))+
stat_cor(method = "pearson",aes(label = paste(..rr.label..,..r.label..,..p.label.., sep = "~`,`~")),label.x = 6)+
labs(x = "Optimal Growth Temperature (°C)", y = expression("Growth Rate" ~ (d^{-1})))+
theme(legend.position = "bottom",legend.direction = "horizontal",legend.justification = "right",axis.title.x = element_text(size = 18,hjust = 0.5),
axis.title.y = element_text(size = 18, hjust = 0.5),strip.text = element_text(size = 18)) +
scale_color_manual("Taxonomic Clades",values = col) +
facet_grid(.~temp,scales = "free",labeller = labeller(temp = Temp.labs)) +
theme_classic(base_line_size = 1, base_size = 16, base_rect_size = 1) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1), panel.border = element_rect(colour = "black", size = 1, fill = NA))
ggplot(GR_OGT_Clade,aes(x = OGT,y = mumax)) +
geom_point(aes(color = `Temp ClusterName`)) +
stat_smooth(method = "lm", se = F,aes(group = 1))+
stat_cor(method = "pearson",aes(label = paste(..rr.label..,..r.label..,..p.label.., sep = "~`,`~")),label.x = 6)+
labs(x = "Optimal Growth Temperature (°C)", y = expression("Growth Rate" ~ (d^{-1})))+
#theme(legend.position = "bottom",legend.direction = "horizontal",legend.justification = "right",axis.title.x = element_text(size = 18,hjust = 0.5),
#axis.title.y = element_text(size = 18, hjust = 0.5),strip.text = element_text(size = 18)) +
scale_color_manual("Taxonomic Clades",values = col) +
facet_grid(.~temp,scales = "free",labeller = labeller(temp = Temp.labs)) +
theme_classic(base_line_size = 1, base_size = 16, base_rect_size = 1) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1), panel.border = element_rect(colour = "black", size = 1, fill = NA))
ggplot(GR_OGT_Clade,aes(x = OGT,y = mumax)) +
geom_point(aes(color = `Temp ClusterName`)) +
stat_smooth(method = "lm", se = F,aes(group = 1))+
stat_cor(method = "pearson",aes(label = paste(..rr.label..,..r.label..,..p.label.., sep = "~`,`~")),label.x = 6)+
labs(x = "Optimal Growth Temperature (°C)", y = expression("Growth Rate" ~ (d^{-1})))+
scale_color_manual("Taxonomic Clades",values = col) +
facet_grid(.~temp,scales = "free",labeller = labeller(temp = Temp.labs)) +
theme_classic(base_line_size = 1, base_size = 16, base_rect_size = 1) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1), panel.border = element_rect(colour = "black", size = 1, fill = NA), legend.position = "bottom")
tiff("./Plots/Avg GR vs. OGT by Temp & Clade.tiff",width = 15,height = 10, units = "in", res = 1200)
ggplot(GR_OGT_Clade,aes(x = OGT,y = mumax)) +
geom_point(aes(color = `Temp ClusterName`)) +
stat_smooth(method = "lm", se = F,aes(group = 1))+
stat_cor(method = "pearson",aes(label = paste(..rr.label..,..r.label..,..p.label.., sep = "~`,`~")),label.x = 6)+
labs(x = "Optimal Growth Temperature (°C)", y = expression("Growth Rate" ~ (d^{-1})))+
scale_color_manual("Taxonomic Clades",values = col) +
facet_grid(.~temp,scales = "free",labeller = labeller(temp = Temp.labs)) +
theme_classic(base_line_size = 1, base_size = 16, base_rect_size = 1) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1), panel.border = element_rect(colour = "black", size = 1, fill = NA), legend.position = "bottom")
dev.off()
library(ggpubr) # stat_cor() & ggplot()
library(reshape2) # melt()
# ------------------------------load files and set them up -------------------------------------------------------------
# read amino acid data and phylogenetic data
genomes = read.table("./Data/Colwelliaceae Rooted PATRIC Data.tsv",fill=T,head=T,sep="\t",colClasses="character")
WGAA = read.table("./Data/WG Indice Data.tsv",fill = T,head = T, sep = "\t",colClasses = 'character', row.names = 1)
Main.Clust.ID = read.table("./Data/Genera Clade ID.tsv",fill=T,head=T,sep="\t",colClasses="character")
#read optimal growth temperature data
OGT = read.table("./Data/Strain Ratk OGT Final.tsv",sep="\t",head=T,stringsAsFactors=FALSE) # OGT table
# set up matching column names
colnames(Main.Clust.ID)[1] = "strain"
colnames(OGT)[1] = "strain"
#-------------------------------------set up color schemes ------------------------------------------------------------
# set colors for genera clusters
Main.Colors = c("Clade A" = "darkgreen","Clade B" = "orange","Clade C" = "purple","Other Colwelliaceae" = "black")
#---------------------------------------set up main dataframe --------------------------------------------------------
#merge to have the OGT with Genera CLuster ID and add PATRIC ID
OGT.Clust = merge.data.frame(Main.Clust.ID,OGT, by = "strain", all = F)
OGT.Clust$ID = genomes$genome.genome_id[match(OGT.Clust$strain,genomes$genome.genome_name)]
rownames(OGT.Clust) = OGT.Clust$ID
OGT.Clust$ID = NULL
# merge dataframe with genome amino acid indices and make column numeric
WG_Data = merge.data.frame(OGT.Clust,WGAA,by = "row.names",all = F)
WG_Data$Row.names = NULL
cols.num = colnames(WG_Data)[c(3,5,6,7,8,9,10)]
WG_Data[cols.num] = sapply(WG_Data[cols.num],as.numeric)
#melt dataframes
WG_Data_melt = melt(WG_Data,id.vars = c("strain","Type","ClusterName","OGT"))
WG_Data_melt$variable = as.character(WG_Data_melt$variable)
#convert the variable names to proper format
WG_Data_melt$variable[WG_Data_melt$variable == "Arg.Lys.Ratio"] = "Arginine-Lysine Ratio"
WG_Data_melt$variable[WG_Data_melt$variable == "Aromaticity.Index"] = "Aromaticity Index"
WG_Data_melt$variable[WG_Data_melt$variable == "Aliphatic.Index"] = "Aliphatic Index"
WG_Data_melt$variable[WG_Data_melt$variable == "Proline.Residue.Proportion"] = "Proline Residue Proportion"
WG_Data_melt$variable[WG_Data_melt$variable == "Acidic.Residue.Proportion"] = "Acidic Residue Proportion"
WG_Data_melt$variable = factor(WG_Data_melt$variable, levels = c("Acidic Residue Proportion", "Aliphatic Index", "Arginine-Lysine Ratio", "Aromaticity Index", "GRAVY", "Proline Residue Proportion"),
labels = c("(A)~~~Acidic~Residue~Proportion~by~OGT", "(B)~~~Aliphatic~Index~by~OGT", "(C)~~~Arginine-Lysine~Ratio~by~OGT", "(D)~~~Aromaticity~Index~by~OGT", "(E)~~~GRAVY~by~OGT", "(F)~~~Proline~Residue~Proportion~by~OGT"))
ggplot(WG_Data_melt,aes(x = OGT,y = value)) +
geom_point(aes(color = ClusterName,shape = ClusterName),size = 2)+
geom_smooth(method = "lm", se = F,aes(group = 1)) +
stat_cor(method = "pearson",aes(label = paste(..rr.label..,..r.label..,..p.label.., sep = "~`,`~")),label.x = 15)+
labs(x = "Optimal Growth Temperature (°C)", y = "Amino Acid Index")+
# theme(legend.position = "bottom",legend.direction = "horizontal",axis.title.x = element_text(size = 13,hjust = 0.5),axis.title.y = element_text(size = 13,hjust = 0.5),
#       strip.text = element_text(size = 13),strip.background = element_blank(),
#       strip.placement = "outside",legend.justification = "center",panel.spacing.y = unit(4,"lines"),
#       axis.text.x = element_text(size = 12),axis.text.y = element_text(size = 12)) +
scale_color_manual("Taxanomic Clades",values = c("darkgreen","orange","purple","black"),labels = c("Clade A","Clade B","Clade C","Other Colwelliaceae")) +
scale_shape_manual("Taxanomic Clades",values = c(15,16,17,18),labels = c("Clade A","Clade B","Clade C","Other Colwelliaceae")) +
facet_wrap(~variable,scales = "free" ,labeller = label_parsed) +
scale_y_continuous() +
theme_classic(base_line_size = 1, base_size = 16, base_rect_size = 1) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1), panel.border = element_rect(colour = "black", size = 1, fill = NA), legend.position = "bottom")
tiff("./Plots/Genome AA vs. OGT.tiff",width = 15,height = 10, units = "in", res = 1200)
ggplot(WG_Data_melt,aes(x = OGT,y = value)) +
geom_point(aes(color = ClusterName,shape = ClusterName),size = 2)+
geom_smooth(method = "lm", se = F,aes(group = 1)) +
stat_cor(method = "pearson",aes(label = paste(..rr.label..,..r.label..,..p.label.., sep = "~`,`~")),label.x = 15)+
labs(x = "Optimal Growth Temperature (°C)", y = "Amino Acid Index")+
scale_color_manual("Taxanomic Clades",values = c("darkgreen","orange","purple","black"),labels = c("Clade A","Clade B","Clade C","Other Colwelliaceae")) +
scale_shape_manual("Taxanomic Clades",values = c(15,16,17,18),labels = c("Clade A","Clade B","Clade C","Other Colwelliaceae")) +
facet_wrap(~variable,scales = "free" ,labeller = label_parsed) +
scale_y_continuous() +
theme_classic(base_line_size = 1, base_size = 16, base_rect_size = 1) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1), panel.border = element_rect(colour = "black", size = 1, fill = NA), legend.position = "bottom")
dev.off()
citation(treeio)
library(treeio)
citation(treeio)
citation("treeio")
citation("growthrates")
version("treeio")
citation("ggtree")
browseVignettes("ggtree")
browseVignettes("ggtree")
library(ggtree)
citation("minpack.lm")
# create pangenome vs core genome plot, volcano plot, and pairwise differences of protein family and OGT
source("./Plain Code/f-pangenome.R")
library(DECIPHER) # ReadDendrogram()
library(ape) # read.tree()
library(reshape2) # melt()
library(RColorBrewer) # brewer.ap()
library(phytools) #midpoint.root()
library(dendextend)  # set()
library(colorspace) # rainbow_hcl()
library(phylogram) # read.dendrogram()
library(rlang) # is_empty()
library(dplyr) # filter()
library(ggplot2) # ggplot()
library(ggridges) # geom_density_ridges()
theme_set(theme_ridges())
# ------------------------------------------------------------load files -------------------------------------------------------------
# load PATRIC phylogenetic and protein family files
treefile="./Data/Colwelliaceae Rooted Tree.nwk"
genomes = read.table("./Data/Colwelliaceae Rooted PATRIC Data.tsv",fill=T,head=T,sep="\t",colClasses="character")
colfeat = read.table("./Data/Colwelliaceae PF Features.tsv",fill = T,head = T,sep = "\t",colClasses = "character") # patric protein features
plfdat = read.table("./Data/Colwelliaceae_families_local.tsv",sep="\t",row.names = 1, stringsAsFactors=F, quote="",comment="")[,3,drop=F]
pgfdat = read.table("./Data/Colwelliaceae_families_global.tsv",sep="\t",row.names=1, stringsAsFactors=F, quote="",comment="")[,3,drop=F]
# load Protein family amino acid indice calculations
colind = read.table("./Data/Protein Indices Data.tsv",row.names = 1, sep="\t",stringsAsFactors = F) # Protein Amino Acid Index
colsave = readRDS("./Data/Colwelliaceae PF AA Calc.RDS")
# load OGT by strain and  Sub-Clade IDs
ratk = read.table("./Data/Strain Ratk OGT Final.tsv",sep="\t",head=T,stringsAsFactors=FALSE) # OGT table
Temp.Clust.ID = read.table("./Data/Sub-Clade ID.tsv",fill=T,head=T,sep="\t",colClasses="character")
# set up list of literature based Colwellia growth rates
ex_col = paste(c("Colwellia psychrerythraea ACAM 605","Colwellia hornerae strain ACAM 607","Colwellia piezophila ATCC BAA-637","Colwellia demingiae strain ACAM 459",
"Colwellia psychotropica"),collapse = "|")
taxaname = "Colwellia (PGF)"
#---------------------------------------------------------- Format Files -----------------------------------------------------------------
#read whole-genome tree from PATRIC
tre.dend = ReadDendrogram(treefile)
tre.phylo = read.tree(treefile)
#set up patric metatable
rownames(genomes) = genomes$genome.genome_id
#set up protein features
rownames(colfeat) = colfeat$feature.patric_id
colfeat = colfeat[,-2]
colnames(colfeat)[1] = "genome.genome_id"
# limit datasets to common genomes and merge protein features and amino acid indices into dataframe
common_ids = intersect(rownames(colfeat), rownames(colind))
colfeat = colfeat[common_ids, ]
colind = colind[common_ids, ]
colout = data.frame(colfeat, colind)
# add the patric ids to the OGT strains
rownames(ratk) = ratk$strn
genome_ID = genomes[,c(2,3)]
genome_ID = subset(genome_ID,genome.genome_id %in% tre.phylo$tip.label)
ratk$id.patric = genome_ID$genome.genome_id[match(ratk$strn,genome_ID$genome.genome_name)]
#-------------------------------------------------------set up phylogeny -----------------------------------------------------------------
#use the global protein family
mat = as.matrix(colsave[[1]])
mat[is.infinite(mat)] = NA
mat[is.nan(mat)] = NA
mat[mat==0] = NA
# keep only genomes that are in both the tree and the amino acid indices calculations
mattmp = mat[,intersect(tre.phylo$tip.label, colnames(mat))]
dend = keep.tip(tre.phylo, intersect(tre.phylo$tip.label,colnames(mattmp)))
# clean up and reorder tree
dend$node.label = NULL # Need to remove node labels
dend = midpoint.root(dend)
dend = ladderize(dend)
dend = drop.tip(dend,"1380381.3") #drop long tip (poor genome assembly)
# convert from 'phylo' to 'dendrogram'
dend1 = ReadDendrogram(textConnection(write.tree(dend)))
#dend1 = set(dend1, "branches_lwd", 5)
#--------------------------------------------------------------set up color scheme----------------------------------------------------------
#set up OGT colors
cols = rev(brewer.pal(11, "RdBu"))
pal = colorRampPalette(c("blue", "red")) # Define colour pallete
pal = colorRampPalette(cols) # Use the following line with RColorBrewer
#Rank variable for colour assignment
rowcols = ratk$OGT[match(labels(dend1),ratk$id.patric)]
rc.order = findInterval(rowcols, sort(rowcols))
rowcols = pal(length(sort(rowcols)))[rc.order]
#set up Sub-Clade Colors
Temp.Clust.colors = c("Clade A1" = "seagreen3","Clade A2" = "olivedrab4","Clade A3" = "chartreuse3",
"Clade B1" = "darkorange2", "Clade B2" = "darkgoldenrod3",
"Clade C" = "purple")
Temp.Clust.ID$Temp_colors = Temp.Clust.colors[match(Temp.Clust.ID$ClusterName, names(Temp.Clust.colors))]
Temp.Clust.ID[is.na(Temp.Clust.ID)] = "black"
# Example: plot pca according to phylogeny ( Aliphatic Index, global protein)
cs = colsave[[13]]
cs = as.matrix(cs)
cs[is.nan(cs)] = NA
cs = cs[rowSums(!is.na(cs)) > 0.8*ncol(cs),]
cs[is.na(cs)] = mean(cs,na.rm=T)
pc = prcomp(t(cs),center=T)
csn = genomes$genome.genome_name[match(colnames(cs),genomes$genome.genome_id)]
csc = as.factor(Temp.Clust.ID$Temp_colors[match(csn,Temp.Clust.ID$label)]) # get the cluster color
cst = as.factor(Temp.Clust.ID$ClusterName[match(csn,Temp.Clust.ID$label)]) # get the clustertype
cso = as.numeric(ratk$OGT[match(csn,ratk$strn)])
# set up color scheme for Sub_Genus Clusters and OGT
rowcols.temp = cso
rc.order.temp = findInterval(rowcols.temp, sort(rowcols.temp))
rowcols.temp = pal(length(sort(rowcols.temp)))[rc.order.temp]
data = as.data.frame(pc$x)
data$ClusterName = cst
data$OGT = cso
data$OGT_color = rowcols.temp
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
guides(fill = guide_legend(title = "Clades")) +
ggtitle("(B)  PCA of Aliphatic Index by Protein Family Colored by Sub-Clades") +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom", plot.title = element_text(hjust = 0.5))
tiff("./Plots/PCA by Cluster.tiff",width = 8,height = 5.5, units = "in", res = 1200)
ggplot(data,aes(PC1,PC2,color = ClusterName)) +
geom_point(size = 3) +
scale_color_manual(name = "Clade",labels = c("Clade A1","Clade A2","Clade A3","Clade B1","Colwellia BRX10.3 & Other Clade B (Clade B2)","Clade C","Other Colwelliaceae"),
values = c("seagreen3","olivedrab4","chartreuse3","darkorange2","darkgoldenrod3","purple","black")) +
guides(fill = guide_legend(title = "Clades")) +
ggtitle("(B)  PCA of Aliphatic Index by Protein Family Colored by Sub-Clades") +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1),legend.position = "bottom", plot.title = element_text(hjust = 0.5))
dev.off()
tiff("./Plots/PCA by OGT.tiff",width = 8,height = 5.5, units = "in", res = 1200)
ggplot(data,aes(PC1,PC2, colour = OGT)) +
geom_point(color = as.character(data$OGT_color), size = 3) +
ggtitle("(A)  PCA of Aliphatic Index by Protein Family Colored by OGT") +
theme_classic(base_line_size = 1, base_size = 11) +
theme(panel.grid.major = element_line(color = "lightgrey", size = 0.1), plot.title = element_text(hjust = 0.5))
dev.off()
